---
trigger: always_on
glob: "issues/**/*.md"
description: 課題管理（Issue Tracking）の運用ルール
---

# 課題管理ガイドライン

このプロジェクトでは、Gitリポジトリ内のファイルベースで課題管理を行っています。Antigravityは以下のルールに従って課題を管理してください。

## 1. ディレクトリ構造
状態に応じて、ファイルを以下のディレクトリ間で移動させます。
- `issues/00_BACKLOG/`: バックログ（将来のタスク）
- `issues/10_TODO/`: 準備完了（次にやるタスク）
- `issues/20_DOING/`: 実行中（現在取り組んでいるタスク）
- `issues/90_DONE/`: 完了済み

## 2. 課題の起票

### 2.1. 新規課題の作成
ユーザーからの依頼や作業中に新たなタスクが発生した場合、以下の手順で課題を起票します。

1. **`make issue` コマンドを実行**して `00_BACKLOG` に課題を作成する
   ```bash
   make issue
   # タイトルを入力（例: "Vertex AI token endpoint の作成"）
   ```
   
2. **課題ファイルを編集**して以下を記載する：
   - **Summary**: 課題の背景と目的を簡潔に説明
   - **Tasks**: 具体的な作業項目をチェックボックス形式で列挙
   - **Notes**: 参考情報、ドキュメントへのリンク、制約事項など

### 2.2. 課題の粒度
- 1つの課題は **1～2時間で完了できる単位** を目安にする
- 大きな機能は複数の課題に分割する
- 例: `create_backend.md` は「バックエンドのセットアップ」と「エンドポイントの実装」を分離

## 3. 状態遷移の操作

### 3.1. 着手時（BACKLOG/TODO → DOING）
作業を開始する際は、以下の手順で課題を `20_DOING` に移動します。

```bash
# ディレクトリが存在しない場合は作成
mkdir -p issues/20_DOING

# git mv で履歴を保持しながら移動
git mv issues/00_BACKLOG/課題名.md issues/20_DOING/
# または
git mv issues/10_TODO/課題名.md issues/20_DOING/
```

**着手タイミング**:
- ユーザーから明示的な依頼があった時
- 前の課題が完了し、次の論理的なステップに進む時
- 一度に複数の課題を DOING にしない（集中するため）

### 3.2. 完了時（DOING → DONE）
課題が完了したら、以下の手順で `90_DONE` に移動します。

```bash
# ディレクトリが存在しない場合は作成
mkdir -p issues/90_DONE

# 完了した課題を移動
git mv issues/20_DOING/課題名.md issues/90_DONE/
```

**完了条件**:
- すべてのタスクチェックボックスが `[x]` になっている
- 関連するコード変更がコミット済み
- 動作確認が完了している（該当する場合）

## 4. 課題の更新

### 4.1. 進捗の記録
作業の進捗に応じて、課題ファイルを更新します。

**タスクチェックボックスの更新**:
```markdown
## Tasks
- [x] FastAPI プロジェクトの作成
- [x] 依存関係の追加
- [ ] エンドポイント実装（← 現在作業中）
- [ ] 動作確認
```

**更新のタイミング**:
- 各タスクが完了したタイミングで即座に更新
- ファイル作成、コマンド実行、動作確認などの節目で更新

### 4.2. Notes セクションの活用
作業中に判明した重要な情報は `## Notes` セクションに追記します。

**記載内容の例**:
- 技術的な制約や仕様の確認事項
- 参考にしたドキュメントのURL
- 設定値やAPIキーの扱い方
- 次の課題への引き継ぎ事項

```markdown
## Notes
- `asia-northeast1` リージョンを使用することに決定
- サービスアカウントキーは `credentials/` 以下に配置
- API Key は開発環境では手動設定、本番環境では別途検討
```

## 5. 完了報告とコミット

### 5.1. 完了時の確認事項
課題を `90_DONE` に移動する前に、以下を確認してください。

✅ **チェックリスト**:
- [ ] すべてのタスクチェックボックスが `[x]` になっている
- [ ] 関連するコード変更がすべて完了している
- [ ] 動作確認が完了している（該当する場合）
- [ ] 重要な情報が Notes に記載されている
- [ ] 次の課題や引き継ぎ事項が明確になっている

### 5.2. コミットメッセージとの連携
課題の状態変更は、関連するコミットと一緒に行います。

**推奨されるコミットの流れ**:
1. 課題の実装を行う（コード変更）
2. すべてのタスクを `[x]` に更新
3. 課題を `90_DONE` に移動
4. まとめてコミット

```bash
# 例: Vertex AI token endpoint の実装完了
git add apps/api/src/main.py
git add issues/90_DONE/create_vertexai_token_endpoint.md
git commit -m "feat: Vertex AI token endpoint を実装

- Google Auth を使用したトークン取得
- CORS 設定の追加
- API Key 認証の実装

Closes #create_vertexai_token_endpoint"
```

## 6. Antigravity の自律的な課題管理

### 6.1. 課題の自動起票
Antigravity は、作業を進める中で新たなタスクが必要だと判断した場合、自律的に課題を起票できます。

**起票が推奨されるケース**:
- 大きな機能を分割する必要がある時
- ユーザーの要望から派生した関連タスクが見つかった時
- 技術的な制約により追加作業が必要になった時

**手順**:
1. `make issue` で課題を作成
2. ユーザーに「新しい課題を起票しました」と報告
3. すぐに着手すべきか、バックログに残すか確認

### 6.2. 複数課題の扱い
**原則**: 一度に1つの課題に集中する

**例外**:
- 2つの課題が密接に関連している場合は、同時に進めることも可
- その場合は、両方の課題を `20_DOING` に移動し、ユーザーに説明する

### 6.3. 課題の優先順位付け
`00_BACKLOG` と `10_TODO` の使い分け：
- **BACKLOG**: 将来的に対応したいが、優先度は低い
- **TODO**: 次に着手すべき、準備が整った課題

Antigravity は、ユーザーの要望や技術的な依存関係を考慮して、適切に振り分けます。

## 7. イシュー駆動開発（Issue-Driven Development）

このプロジェクトでは、すべての作業を課題ベースで管理します。

**基本原則**:
1. **課題なしでコードを書かない**: 小さな修正でも課題を作成
2. **課題ごとにコミット**: 1つの課題 = 1つ以上のコミット
3. **課題の履歴が作業履歴**: 課題を見れば、何をいつ行ったかがわかる

**メリット**:
- 作業の可視化と振り返りが容易
- Git の履歴と課題が紐づき、コンテキストが明確
- チーム開発や引き継ぎがスムーズ

## 8. トラブルシューティング

### 8.1. 課題が複雑すぎる場合
→ 複数の小さな課題に分割する

### 8.2. 課題の途中で別の作業が必要になった場合
→ 新しい課題を起票し、元の課題に参照を記載

### 8.3. 完了したはずの課題に追加作業が必要になった場合
→ 新しい課題として起票（`90_DONE` から戻さない）
