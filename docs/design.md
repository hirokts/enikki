# ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³ & å®Ÿè£…è¨­è¨ˆ

## 1. ã‚³ãƒ³ã‚»ãƒ—ãƒˆ: æ—¥å ±ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ

### èª²é¡Œæ„Ÿ
- æ—¥å ±ã‚’å¤•æ–¹ã«æ›¸ãã®ãŒè¾›ã„ï¼ˆç–²ã‚Œã€å®¶æ—ã®ç”¨äº‹ãªã©ï¼‰
- ã‚ã‚“ã©ãã•ãã¦ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã—ã¾ã†
- ã€ŒåŒå±…äººã«æ™©å¾¡é£¯ã‚’èã‹ã‚Œã¦æ€è€ƒåœæ­¢ã™ã‚‹ã€ã‚ˆã†ãªçŠ¶æ³ã‚’æ•‘ã„ãŸã„

### ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³
- **éŸ³å£°ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼å½¢å¼ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
- æ•°èªè©±ã™ã ã‘ã§ã€AIãŒæ–‡è„ˆã‚„äºˆå®šã‚’åŠ å‘³ã—ã¦çµµæ—¥è¨˜ãƒ»æ—¥å ±ã‚’ä½œæˆ
- "ã¼ãã®å¤ä¼‘ã¿" é¢¨ã®çµµæ—¥è¨˜ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼

### ã‚¹ã‚³ãƒ¼ãƒ—
1. **å…¥åŠ›**: éŸ³å£°ã§ä»Šæ—¥ã®å‡ºæ¥äº‹ã‚’è©±ã™ï¼ˆ4å˜èªç¨‹åº¦ã§ã‚‚OKï¼‰
2. **å¤‰æ›**: AIãŒãƒ†ã‚­ã‚¹ãƒˆåŒ–ã—ã€çµµæ—¥è¨˜é¢¨ã®æ–‡ç« ã«å¤‰æ›
3. **æç”»**: æ–‡ç« ã‚’å…ƒã«ç”»åƒã‚’ç”Ÿæˆ
4. **å‡ºåŠ›**: çµµæ—¥è¨˜ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’æ—¥ä»˜ã¨ã¨ã‚‚ã«ä¿å­˜

![Concept Image](https://hackmd.io/_uploads/BkHbGKsHZe.jpg)

---

## 2. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### å…¨ä½“æ§‹æˆå›³
- **Frontend**: SvelteKit @ Firebase App Hosting
- **Backend**: Python / FastAPI @ Cloud Run
- **DB/Storage**: Firestore, Cloud Storage
- **AI**: Gemini Pro 2.0 (Vertex AI), Gemini 2.5 Flash Image (ç”»åƒç”Ÿæˆ)

### å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å½¹å‰²

#### ğŸ–¥ï¸ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (SvelteKit)
- **å½¹å‰²**:
    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆéŒ²éŸ³ã€é–²è¦§ï¼‰
    - **Vertex AI Multimodal Live API ã¸ã®ç›´æ¥æ¥ç¶š** (WebRTC/WebSocket)
    - éå»ã®æ—¥è¨˜é–²è¦§ï¼ˆãƒªã‚¹ãƒˆ/ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºï¼‰
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: Firebase App Hosting

#### âš™ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Cloud Run / FastAPI)
- **å½¹å‰²**:
    1.  **Auth (èªè¨¼)**: FrontendãŒGeminiã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®ã€ŒçŸ­æœŸãƒˆãƒ¼ã‚¯ãƒ³ã€ç™ºè¡Œ
    2.  **Summary (å¾Œå‡¦ç†)**: ä¼šè©±ãƒ­ã‚°ã‚’å—ã‘å–ã‚Šã€æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰ã«ã—ã¦ä¿å­˜
    3.  **Job**: Imagen 3 ã§ã®ç”»åƒç”Ÿæˆãƒˆãƒªã‚¬ãƒ¼
- **æŠ€è¡“**: Python, FastAPI

#### ğŸ’¾ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ & ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **Cloud Firestore**:
    - æ—¥è¨˜ãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¥ä»˜ã€æœ¬æ–‡ã€ç”»åƒURLã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰
    - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ ï¼ˆNoSQLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæŒ‡å‘ï¼‰
- **Cloud Storage**:
    - ç”Ÿæˆã•ã‚ŒãŸçµµæ—¥è¨˜ç”»åƒã®ä¿å­˜

---

## 3. å®Ÿè£…è©³ç´°: éŸ³å£°å¯¾è©±ãƒ•ãƒ­ãƒ¼

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒã‚¤ãƒ³ãƒˆ
**ã€Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ Gemini (Vertex AI) ã¸ç›´æ¥ã¤ãªãã€** æ§‹æˆã‚’æ¡ç”¨ã—ã¾ã™ã€‚

> ğŸš« **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ä¸­ç¶™ã—ãªã„ç†ç”±**
> * **é…å»¶å›é¿**: Server-side WebRTCä¸­ç¶™ã«ã‚ˆã‚‹ãƒ©ã‚°ã‚’é˜²ã
> * **è¤‡é›‘æ€§å›é¿**: éŸ³å£°ã‚¹ãƒˆãƒªãƒ¼ãƒ ç®¡ç†ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›

### å‡¦ç†ãƒ•ãƒ­ãƒ¼
1.  **ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—**:
    *   Client -> Backend: æ¥ç¶šãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    *   Backend -> Client: Vertex AI ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œ
2.  **å¯¾è©± (Real-time)**:
    *   Client <-> Vertex AI: WebRTC/WebSocketã§éŸ³å£°å¯¾è©±
    *   ãƒã‚¤ã‚¯å…¥åŠ› -> Gemini
    *   GeminiéŸ³å£° -> ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼
3.  **ä¿å­˜ (Post-process)**:
    *   ä¼šè©±çµ‚äº†å¾Œã€Client -> Backend: ä¼šè©±ãƒ­ã‚°é€ä¿¡
    *   Backend: è¦ç´„ç”Ÿæˆ -> ç”»åƒç”Ÿæˆ -> Firestoreä¿å­˜

---

## 4. é–‹ç™ºåˆ†æ‹… & ç’°å¢ƒ

### æ‹…å½“é ˜åŸŸ
* **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ‹…å½“**:
    * ãƒã‚¤ã‚¯å…¥åŠ›ã® UI ã¨éŸ³å£°æ³¢å½¢ã®è¡¨ç¤ºã€‚
    * Vertex AI SDK ã‚’ä½¿ã£ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã®å®Ÿè£…ã€‚
    * Firestore ã‹ã‚‰æ—¥è¨˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤ºã™ã‚‹ç”»é¢ã€‚
    * ä¼šè©±ã—ã¦ã€ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã•ã›ã¦çµµæ—¥è¨˜æ–‡ç« ã®ææ–™ã‚’ç”Ÿæˆã•ã›ã¦ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ãƒã‚¹ãƒˆã™ã‚‹

* **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆCloud Runï¼‰æ‹…å½“**:
    * Gemini ç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä½œæˆã€‚
    * ä¼šè©±çµ‚äº†å¾Œã«ã€Œ4å˜èªã‚’æŠ½å‡º â†’ æ—¥è¨˜ä½œæˆ â†’ ç”»åƒç”Ÿæˆã€ã‚’è¡Œã†éåŒæœŸã‚¸ãƒ§ãƒ–ã®å®Ÿè£…ã€‚
    * Firestore ã®ãƒ‡ãƒ¼ã‚¿æ›´æ–°
    * Discord ã‚„ Slack ã¸ã®é€šçŸ¥é€£æºã€‚


### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º (Docker Compose)
*   ãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã§ã‚‚ã€**Vertex AI ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®å®Ÿãƒªã‚½ãƒ¼ã‚¹**ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
*   Google Cloud èªè¨¼ï¼ˆADCï¼‰ã¨ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡ŒãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã‹ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®éµã§ã™ã€‚

---

## 5. çµµæ—¥è¨˜ç”Ÿæˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (LangGraph)

ä¼šè©±ãƒ­ã‚°ã‹ã‚‰çµµæ—¥è¨˜ã‚’ç”Ÿæˆã™ã‚‹å‡¦ç†ã‚’ã€**LangGraph** ã‚’ä½¿ã£ãŸã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦å®Ÿè£…ã—ã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€å‡¦ç†ã®æµã‚ŒãŒæ˜ç¢ºã«ãªã‚Šã€å“è³ªãƒã‚§ãƒƒã‚¯â†’å†ç”Ÿæˆã®ãƒ«ãƒ¼ãƒ—ï¼ˆAgentic ãªè‡ªå·±æ”¹å–„ï¼‰ã‚‚è¡¨ç¾ã§ãã¾ã™ã€‚

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›³

```mermaid
flowchart TD
    START([ğŸ™ï¸ ä¼šè©±ãƒ­ã‚°å—ä¿¡]) --> extract[ğŸ“ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º<br/>Gemini]
    extract --> generate[âœï¸ æ—¥è¨˜æ–‡ç« ç”Ÿæˆ<br/>Gemini]
    generate --> check{ğŸ” å“è³ªãƒã‚§ãƒƒã‚¯<br/>Gemini}
    check -->|OK| image[ğŸ¨ ç”»åƒç”Ÿæˆ<br/>Imagen 3]
    check -->|NG & retry < 3| generate
    check -->|NG & retry >= 3| fallback[âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†]
    image --> save[ğŸ’¾ Firestore ä¿å­˜]
    fallback --> save
    save --> END([âœ… å®Œäº†])
```

### å„ãƒãƒ¼ãƒ‰ã®å½¹å‰²

| ãƒãƒ¼ãƒ‰ | å‡¦ç†å†…å®¹ | ä½¿ç”¨API |
|--------|----------|---------|
| `extract` | ä¼šè©±ãƒ­ã‚°ã‹ã‚‰4ã¤ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º | Gemini Pro |
| `generate` | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…ƒã«ã€Œã¼ãã®å¤ä¼‘ã¿ã€é¢¨ã®æ—¥è¨˜ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ | Gemini Pro |
| `check` | ç”Ÿæˆã•ã‚ŒãŸæ–‡ç« ã®å“è³ªè©•ä¾¡ï¼ˆå­ä¾›ã‚‰ã—ã•ã€çµµæ—¥è¨˜ã‚‰ã—ã•ï¼‰ | Gemini Pro |
| `image` | æ—¥è¨˜ãƒ†ã‚­ã‚¹ãƒˆã‚’å…ƒã«çµµæ—¥è¨˜é¢¨ã®ç”»åƒã‚’ç”Ÿæˆ | Gemini 2.5 Flash Image |
| `save` | çµæœã‚’ Firestore ã«ä¿å­˜ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ `completed` ã«æ›´æ–° | Firestore |

### çŠ¶æ…‹ç®¡ç† (State)

```python
class DiaryState(TypedDict):
    document_id: str          # Firestore ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ID
    conversation_log: dict    # å…¥åŠ›: ä¼šè©±ãƒ­ã‚°ï¼ˆreport_diary_event ã®å¼•æ•°ï¼‰
    keywords: list[str]       # æŠ½å‡ºã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
    diary_text: str           # ç”Ÿæˆã•ã‚ŒãŸæ—¥è¨˜ãƒ†ã‚­ã‚¹ãƒˆ
    quality_score: float      # å“è³ªã‚¹ã‚³ã‚¢ (0.0 - 1.0)
    retry_count: int          # ãƒªãƒˆãƒ©ã‚¤å›æ•°
    image_url: str            # ç”Ÿæˆã•ã‚ŒãŸç”»åƒã® URL
    status: str               # pending / processing / completed / failed
```

### Agentic ãƒã‚¤ãƒ³ãƒˆ

1. **è‡ªå·±è©•ä¾¡ãƒ«ãƒ¼ãƒ—**: ç”Ÿæˆçµæœã‚’åˆ¥ã® Gemini å‘¼ã³å‡ºã—ã§è©•ä¾¡ã—ã€åŸºæº–ã‚’æº€ãŸã•ãªã‘ã‚Œã°å†ç”Ÿæˆ
2. **æ¡ä»¶åˆ†å²**: å“è³ªã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ±ºå®šï¼ˆOK â†’ ç”»åƒç”Ÿæˆ / NG â†’ ãƒªãƒˆãƒ©ã‚¤ï¼‰
3. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: ãƒªãƒˆãƒ©ã‚¤ä¸Šé™ã«é”ã—ãŸå ´åˆã‚‚ graceful ã«çµ‚äº†
